/*! lib - v1.2.0 - 2024-09-29 */
var UploadButton,Reg_=class{constructor(){this.locker={},this.map={},Object.defineProperty(this,"list",{get:function(){return this.export()}})}has(e){return e&&"string"==typeof e||e instanceof Symbol?e instanceof Symbol?!!this.locker[e]:"string"==typeof e?!!this.map[e]&&(e=this.map[e],!!this.locker[e]):void 0:null}save(e,t,r){return this.has(e)&&new Error("That id already taken"),t=r&&r.deep&&r.mime?new Blob([t],{type:r.mime}):t,"string"==typeof e?(r=Symbol(e),this.map[e]=r,this.locker[r]=t):e instanceof Symbol?this.locker[e]=t:void 0}fetch(e){var t,r,s;return this.has(e)?(s=new WeakMap,t={},"string"==typeof e?(r=this.map[e],s.set(t,this.locker[r])):e instanceof Symbol&&s.set(t,this.locker[e]),s.get(t)instanceof Blob?this.fetchDeep(t):s.get(t)):null}async fetchDeep(e){return tmp.get(e).text()}remove(e){var t,r,s,i,a;if(!this.has(e))return null;if("string"==typeof e)return s=this.map[e],delete this.locker[s],delete this.map[e];if(e instanceof Symbol){delete this.locker[e],r=[];for(a of Object.entries(this.map))[t,i]=a,r.push(i===e?delete this.map[t]:void 0);return r}}export(){var e,t,r,s;if(0===Object.keys(this.map).length&&0===Object.keys(this.locker).length)return null;(s=new WeakMap).set(t={},{});for(e of Object.keys(this.map)){if(r=this.map[e],!this.locker[r])throw new Error("Register's integrity is corrupt");Object.defineProperty(s.get(t),e,{value:this.locker[r]})}return s.get(t)}},rand=function(){return Math.random().toString(36).substring(2)},makeToken=function(){return rand()+rand()},isArray=function(e){return Array.isArray(e)},isObject=function(e){return e instanceof Object},findAttr=function(e,t,r={}){var s,i,a,n,o,h,d,l;if(!e||!t||"string"!=typeof e&&!isArray(e)||!t instanceof Element)throw new Error("incorrect function call");d=new WeakMap,n={},isArray(e)||(e=[e]),r.clean&&!isArray(r.clean)&&(r.clean=[r.clean]),d.set(n,{});for(i of e){d.get(n)[i]={};for(a of Array.from(t.querySelectorAll(`[${i}]`)))h=a.getAttribute(i),d.get(n)[i][h]=a}if(r.clean)for(l of Object.entries(d.get(n)))if([s,o]=l,!0===r.clean)for(a of Object.values(o))a.removeAttribute(s);else for(a of Object.values(o))r.clean.includes(s)&&a.removeAttribute(s);return 1===e.length?d.get(n)[e[0]]:d.get(n)},Modal=class{constructor(){this.register={reg:new Reg_,locker:{},history:[],has:function(e){return!!this.locker[e]},add:function(e,t){var r;if(this.has(e))throw new Error("Id already been used");return r=makeToken(),this.locker[e]=r,this.reg.save(r,t)},fetch:function(e){var t;if(!e)return null;if(this.has(e))return t=this.locker[e],this.reg.fetch(t);if(!this.history.includes(e))throw"No such modal"},remove:function(e){var t;return this.has(e)&&(t=this.locker[e],this.reg.remove(t),delete this.locker[e]),!0}}}add(e){var t,r,s,i;try{if(!e||!e instanceof Object)throw"Missing parameter";return[!e.name||"string"!=typeof e.name,!e.html||"string"!=typeof e.html,null!==e.handler&&!e.handler||!e.handler instanceof Object].some(function(e){if(!0===e)throw new Error("Corrupt parameter structure")}),{name:s,html:r,handler:t}=e,(i=document.createElement("template")).innerHTML=t&&t.beforeCreated?t.beforeCreated(r):r,t?this.register.add(s,{name:s,template:i,beforeRegister:t.beforeRegister,onshow:t.onshow,onhide:t.onhide,clean:t.clean}):this.register.add(s,{name:s,template:i})}catch(e){throw`Modal... prototype wasn't created
`+e}}prepare(e){var t,r,s;try{if(e)return s=Symbol(e),t={},r=this.register.fetch(e),Object.defineProperty(t,"name",{value:r.name,writable:!1}),Object.defineProperty(t,"node",{value:r.template.content.firstElementChild,writable:!1}),Object.defineProperty(t,"sym",{value:s,writable:!1}),Object.defineProperty(t,"remove",{value:this.register.remove.bind(this.register),writable:!1}),Object.defineProperty(t,"preserve",{set:function(e){return this.isPreserved=!!e&&"true"}}),Object.defineProperty(t,"onshow",{value:r.onshow,writable:!1}),Object.defineProperty(t,"onhide",{value:r.onhide,writable:!1}),Object.defineProperty(t,"clean",{value:r.clean,writable:!1}),Object.defineProperty(t,"show",{value:function(e){if(!e||!e instanceof Element)throw document.body;return this.container=e,this.onshow&&this.onshow(),e.appendChild(this.node),this.onDisplay=!0},writable:!1,configurable:!1}),Object.defineProperty(t,"hide",{value:function(){return this.wasRemoved?this.wasRemoved():(this.onhide&&this.onhide(),this.container.removeChild(this.node),this.isPreserved?this.onDisplay=!1:(this.remove(this.sym),this.clean&&this.clean(),void(this.clean&&this.isPreserved)))},writable:!1,configurable:!1}),r.beforeRegister&&r.beforeRegister(t),this.register.add(s,t),this.register.history.push(s),s;throw"Missing name"}catch(e){throw`Modal preparation failed
`+e}}find(e){return e&&!(!e instanceof Symbol)&&this.register.has(e)?this.register.fetch(e):null}};class requestFunctions{constructor(){}validateArgs(){try{if(!this.args||!this.args.path||!this.args.method)throw"Missing property,\n either path or method, others are optional";if("GET"!==this.args.method&&"POST"!==this.args.method&&"PUT"!==this.args.method)throw"Unsupported method";if(this.args.headers&&"auto"!==this.args.headers){if(!Array.isArray(this.args.headers))throw"Wrong property instance. The 'headers' property, should be an array instance";if(0===this.args.headers.length)throw"If there is no headers in request, the 'headers' property should be defined as 'auto' ";let r;if(this.args.headers.forEach(function(e,t){r=!(!Array.isArray(e)||2!==e.length||"string"!=typeof e[0]||"string"!=typeof e[1])&&!1!==r}),!r)throw"Corrupted headers structure, all parameters should be an instance of an array, have two indexes, and they should be strings"}if(this.args.data){if(!Array.isArray(this.args.data))throw"Wrong property instance. The 'data' property, should be an array instance";if(0===this.args.data.length)throw"If there is no parameters in request data, the 'data' property should be defined as null";let r;if(this.args.data.forEach(function(e,t){r=e instanceof Object&&"name"in e&&"value"in e&&"string"==typeof e.name&&!1!==r}),!r)throw"Corrupted data structure, all parameters should be an instance of an object, have name and value properties, name schoud be a string"}return!0}catch(e){throw e instanceof Error?"Syntax error":`Provided arguments are invalid
\r`+e}}prepareRequest(){try{if(this.path=this.args.path,this.method=this.args.method,this.headers="auto"===this.args.headers?null:this.args.headers,this.args.data)if("GET"===this.args.method){let t;t="?time="+encodeURIComponent((new Date).toString()),this.args.data.forEach(function(e){t+=`&${e.name}=`+encodeURIComponent(e.value)}),this.path=this.path+t}else if("POST"===this.args.method){let t=new FormData;t.append("time",(new Date).toString()),this.args.data.forEach(function(e){t.append(e.name,e.value)}),this.data=t}}catch(e){throw e instanceof Error?"Syntax error":"While preparing request\n"+e}}}class XHRRequest extends requestFunctions{constructor(e){return super(),this.args=e,this.init()}init(){try{return this.validateArgs(),this.prepareRequest(),this.call()}catch(e){return!1}}call(){return new Promise((t,r)=>{let s=new XMLHttpRequest;this.args.progress&&s.upload.addEventListener("progress",this.args.progress),s.addEventListener("error",e=>{this.args.error&&this.args.error(e),r(e)}),s.addEventListener("abort",e=>{this.args.abort&&this.args.abort(e),r(e)}),s.addEventListener("load",e=>{this.args.load&&this.args.load(e),t(JSON.parse(e.target.response))}),s.open(this.method,this.path,!0),this.headers&&this.headers.forEach(function(e){s.setRequestHeader(e[0],e[1])}),s.send(this.data||null)})}}UploadButton=class{constructor(){return this.prepareNode(),this.export}prepareNode(){var r,e,t=document.createElement("template");return t.innerHTML=`<div role="button">
  <button ref="btn" onclick="this.nextElementSibling.click()" >Browse</button>
  <input  ref="inpt" type="file" hidden />
</div>`,e=this.setup.bind(this),r=(e,t)=>{if("fileReadMethod"===e&&(this.fileReadMethod=t),"readerEncoding"===e)return this.readerEncoding=t},t=t.content.firstElementChild,Object.defineProperty(this,"export",{value:{wrapper:t,button:t.querySelector("[ref=btn]"),input:t.querySelector("[ref=inpt]"),files:[],swapWith:function(e){if(!e||!e instanceof Element||"button"!==e.localName)throw new Error("The button wasn't swapped");return e.addEventListener("click",()=>this.input.click()),e.parentNode.replaceChild(this.wrapper,e),this.wrapper.replaceChild(e,this.button),this.button=e},setup:function(){return e()}}}),Object.defineProperty(this.export,"returnFormat",{set(t){var e=["readAsArrayBuffer","readAsDataURL","readAsText"].some(function(e){return e===t});r("fileReadMethod",e?t:"readAsDataURL")}}),Object.defineProperty(this.export,"encodingFormat",{set(e){r("readerEncoding",e)}}),Object.defineProperty(this.export,"allowMultiple",{set(e){e?this.input.setAttribute("multiple","multiple"):this.input.removeAttribute("multiple","multiple")}})}setup(){return this.export.input.addEventListener("input",e=>Array.from(e.target.files).forEach(t=>{var r=new FileReader;switch(this.fileReadMethod){case"readAsArrayBuffer":r.readAsArrayBuffer(t);break;case"readAsDataURL":r.readAsDataURL(t);break;case"readAsText":this.readerEncoding?r.readAsDataURL(t,this.readerEncoding):r.readAsDataURL(t,"utf-8");break;default:throw new Error("Wrong read method")}return this.export.loadstart&&(r.onloadstart=e=>this.export.loadstart(e)),this.export.progress&&(r.onprogress=e=>this.export.progress(e)),this.export.abort&&(r.onabort=e=>this.export.abort(e)),this.export.loadend&&(r.onloadend=e=>this.export.loadend(e)),this.export.onerror&&(r.onerror=e=>this.export.onerror(e)),r.onload=e=>this.export.onload({name:t.name,size:t.size,type:t.type,src:r.result})}))}};